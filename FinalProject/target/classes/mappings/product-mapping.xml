<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductDAO">
	<insert id="insertProduct" parameterType="product">
		insert into
		product(pnum,ptype1,ptype2,pname,pcompa,pcontent,pimg1,pimg2,psavimg)
		values(PRODUCT_SEQ.nextval, #{ptype1}, #{ptype2},
		#{pname}, #{pcompa},
		#{pcontent}, #{pimg1},#{pimg2},#{psavimg})
	</insert>

	<select id="selectProductList" resultType="product">
	select *
		from product where useitem='Y' and ptype2=#{subcategory}
		order by preg desc
	</select>
	<!-- 검색조건+페이징 목록가져오기 -->
	<select id="selectProductListPaging"
		resultType="com.ezen.biz.dto.ProductVO">
		select * from (
		select rownum rn, A.* from
		(select
		pnum,ptype1,ptype2,pname,pcompa,pcontent,preg from product where 1=1
		<if test="searchtype=='ptype1'">
			and ptype1 like '%' || #{searchword} ||'%'
		</if>
		<if test="searchtype=='ptype2'">
			and ptype2 like '%' || #{searchword} ||'%'
		</if>
		<if test="searchtype=='pname'">
			and pname like '%' || #{searchword} ||'%'
		</if>
		<if test="searchtype=='pcompa'">
			and pcompa like '%' || #{searchword} ||'%'
		</if>
		<if test="searchtype=='pcontent'">
			and pcontent like '%' || #{searchword} ||'%'
		</if>
		and useitem='Y' order by pnum desc) A
		<![CDATA[
			where rownum<=#{pageNum}*#{rowsPerPage}
			) where rn>=#{pageNum}*#{rowsPerPage}-#{rowsPerPage}+1
		]]>

	</select>
	<!-- 제품의 전체개수 가져오기 -->
	<select id="selectRowCount" resultType="java.lang.Integer">
		select count(*) from product where useitem='Y'
	</select>
	<!-- 검색조건에 해당하는 개수 가져오기 -->
	<select id="selectRowCountPaging" resultType="java.lang.Integer">
		select count(*) from product where 1=1
		<if test="searchtype=='pname'">
			and pname like '%' || #{searchword} ||'%'
		</if>
		<if test="searchtype=='pcompa'">
			and pcompa like '%' || #{searchword} ||'%'
		</if>
		<if test="searchtype=='pcontent'">
			and pcontent like '%' || #{searchword} ||'%'
		</if>
		and useitem='Y'
	</select>

	<select id="selectProduct" resultType="product">
		select * from product
		where
		pnum=#{pnum} and useitem='Y'
	</select>

	<update id="updateProduct" parameterType="product">
		update product set pname=#{pname},pcompa=#{pcompa}, ptype1=#{ptype1},
		ptype2=#{ptype2},
		pcontent=#{pcontent}, pimg1=#{pimg1}, pimg2=#{pimg2} ,
		psavimg=#{psavimg}
		where pnum=#{pnum}
	</update>
	
	<update id="deleteProduct" parameterType="product">
		update product set useitem='N' where pnum=#{pnum}
	</update>
	
</mapper>
